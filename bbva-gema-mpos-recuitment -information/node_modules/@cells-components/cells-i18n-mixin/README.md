![cells-i18n-mixin screenshot](cells-i18n-mixin.png)

# cells-i18n-mixin

![Certificated](https://img.shields.io/badge/certificated-yes-brightgreen.svg)

[Demo of component in Cells Catalog](https://bbva-ether-cellscatalogs.appspot.com/?view=demo#/component/cells-i18n-mixin)

`CellsI18nMixin` provides a normalized interface for translate strings.

## Import

1) Import the mixin in your component:

```js
import { CellsI18nMixin } from '@cells-components/cells-i18n-mixin/cells-i18n-mixin.js'
```

2) Use `CellsI18nMixin` to extend from it in the class definition of your component:

```js
class MyElement extends CellsI18nMixin(LitElement) {
  static get is() { return 'my-element' }
}
 ```

## Usage

**string-to-translate** is the key to the string or message ('locale') in the corresponding language, in your **locales/{lang}.json** files.

 __Note:__ It is recommended that the keys have the name of the component as suffix. E.g. 'cells-basic-login-greeting' or 'cells-basic-login-username'

 1. Basic usage (binding)

    ```js
    ${this.doTranslation('string-to-translate')}
    ```

    or, in a shorter but equivalent way (t() is just an alias of doTranslation()):

    ```js
    ${this.t('string-to-translate')}
    ```

 2. Define an optional 'fallback' string with the second parameter (the **Fallback string** will display if **string-to-translate** key doesn't exist in 'locales'.). The fallback text accepts interpolations.

    ```js
    ${this.t('string-to-translate', 'Fallback string')}
    ${this.t('string-to-translate', 'Hello {{name}}', { name: 'John' })}
     ```

 3. For asynchronous translation on connectedCallback:

    ```js
    connectedCallback() {
      super.connectedCallback();
      this.getMsg('string-to-translate').then((translation) => {
        this.set('readyTranslation', translation);
      });
    }
    ```

 4. Define an optional 'interpolation' string object or object with the third parameter:

    ```js
    ${this.t('string-to-translate', '', '{"attribute": "value"}')
    ${this.t('string-to-translate', '', {'attribute': 'value'})
     ```
     
    Interporlation object can be self properties:
    
    ```js
    ${this.t('string-to-stranslate-with-ref-to-self-property')
    ```

__Note:__ If **string-to-translate** contains a comma (,) it must be escaped by preceding it with a '\'

Example:

```js
<p>
 ${this.t('Welcome')}
 <input type="text" placeholder="${this.t('Username, Email or UserID')}">
</p>
```

## Locales (translations)

Finally, have the translations for each language on the *locales* folder.

This folder will have one JSON file for each supported language (en.json, es.json, en-US.json, etc).

For every language the Object defined contains all translated strings indexed by a unique ID, which is the same across all languages.

***en.json:***

```json
{
  "your-component-name-cancel": { // valid legacy syntax
    "message": "Cancel"
  },
  "your-component-name-info": "Information", //simple syntax
  "explicitText": { "${attribute}, hello!" }, // interpolated variable
  "some-key": { "Bye {{attribute}}" }, // alternative supported syntax for interpolation
  "arrayText": ["part1", "part2", "...", "partN"],
  "self-property-msg": "My property value is ${propertyName}"
}
```

***es.json:***

```json
{
  "your-component-name-cancel": "Cancelar", //simple syntax
  "explicitText": { "Hola ${attribute}!" },
  "arrayText": ["part1", "part2", "...", "partN"]
}
```

### Multilevel JSON

JSON with nested keys are supported, however it's encouraged not to use it in standalone components to prevent accidental overrides that may occur when the translation files of the components are merged into a single file in a Cells application. JSON with nested keys are intended to be used in applications (locales-app) and _in-app_ components. Requires setting `unFlattened` in `window.I18nMsg` to `true`.

```js
  window.I18nMsg = window.I18nMsg || {};
  window.I18nMsg.unFlattened = true;
```

### Locale file names

Different file names that those that correspond with the `lang` attribute of the document are supported.
Using it requires setting `files` array property in `window.I18nMsg`. **This feature should not be used in standalone components**. As with multilevel JSON, it is intented to be used in applications.

```js
  window.I18nMsg = window.I18nMsg || {};
  window.I18nMsg.files = ['eng.json', 'spa.json'];
```

## Disable fetching locales

To disable the automatic fetch of the locales, set `window.I18nMsg.disabled` to `true` to
prevent the network request.

In your main html file (index.html):

```js
  window.I18nMsg = window.I18nMsg || {};
  window.I18nMsg.disabled = true;
```

## Disable caching locales

To disable the default caching of locales and force the behaviour to fetch them every time, just set window.I18nMsg.noCache to `true`.

In your main html file (index.html):

```js
  window.I18nMsg = window.I18nMsg || {};
  window.I18nMsg.noCache = true;
```
