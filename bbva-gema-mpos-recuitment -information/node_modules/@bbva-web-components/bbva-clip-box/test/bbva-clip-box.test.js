import { html, fixture, assert, fixtureCleanup } from '@open-wc/testing';

import '../bbva-clip-box.js';
suite('bbva-clip-box', () => {
  suite('Default', () => {
    let el;
    let elementShadowRoot;

    teardown(() => fixtureCleanup());

    setup(async () => {
      el = await fixture(
        html`
          <bbva-clip-box></bbva-clip-box>
        `,
      );
      elementShadowRoot = el.shadowRoot;
      await el.updateComplete;
    });

    test('it shows the first two initials', async () => {
      el.text = 'AAAAAAAA';
      await el.updateComplete;
      const expectedText = 'AA';
      const domEl = elementShadowRoot.querySelector('#initials');
      assert.equal(expectedText, domEl.innerText.trim());
    });

    test('it shows with icon', async () => {
      const expectedIcon = 'coronita:plus';
      el.icon = expectedIcon;
      await el.updateComplete;
      const domEl = el.shadowRoot.querySelector('#icon');
      assert.ok(domEl.getAttribute('class').includes('icon'));
    });

    test('it test show with image', async () => {
      el.image = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
      await el.updateComplete;
      const domEl = el.shadowRoot.querySelector('#icon');
      assert.ok(domEl.getAttribute('class').includes('image'));
    });

    test('it test show with different bgColor', async () => {
      const expected = '--bbva-clip-box-bg-color:#028484;';
      el.bgColor = 'aqua';
      await el.updateComplete;
      el.icon = 'coronita:plus';
      assert.ok(el.getAttribute('style').includes(expected));
    });

    test('a11y', () => assert.isAccessible(el));

    suite('Semantic Dom', () => {
      test('DOM - Structure test', () => {
        assert.dom.equalSnapshot(el);
      });

      test('SHADOW DOM - Structure test', () => {
        assert.shadowDom.equalSnapshot(el);
      });

      test('LIGHT DOM - Structure test', () => {
        assert.lightDom.equalSnapshot(el);
      });
    });
  });
  suite('Custom', () => {
    let el;
    let elementShadowRoot;

    teardown(() => fixtureCleanup());

    setup(async () => {
      el = await fixture(
        html`
          <bbva-clip-box class="bitone" custom></bbva-clip-box>
        `,
      );
      elementShadowRoot = el.shadowRoot;
      await el.updateComplete;
    });

    test('a11y', () => assert.isAccessible(el));
    suite('Semantic Dom', () => {
      test('DOM - Structure test', () => {
        assert.dom.equalSnapshot(el);
      });

      test('SHADOW DOM - Structure test', () => {
        assert.shadowDom.equalSnapshot(el);
      });

      test('LIGHT DOM - Structure test', () => {
        assert.lightDom.equalSnapshot(el);
      });
    });
    test('it shows the first three initials', async () => {
      el.text = 'BAFGD';
      await el.updateComplete;
      const expectedText = 'BAF';
      const domEl = elementShadowRoot.querySelector('#initials');
      assert.equal(expectedText, domEl.innerText.trim());
    });
    test('it shows two background colors in custom mode', async () => {
      el.bgColor = '#F78BE8';
      el.bgColor2 = '#6500a4';
      const expected = '--bbva-clip-box-bg-color:#F78BE8; --bbva-clip-box-bg-color2:#6500a4;';
      await el.updateComplete;
      assert.ok(el.getAttribute('style').includes(expected));
    });
  });
});
